<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizations of Australian Arrivals </title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f4f8;
            max-width: 1200px;
            margin: auto;
            overflow-x: hidden;
            /* Prevent horizontal overflow */
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            /* Allow wrapping for inside section */
            gap: 20px;
        }

        .figures-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            /* Adjust to 1 block at each row - 1 column */
            gap: 20px;
        }

        .figure-item {
            text-align: center;
            background-color: #d3e3ec96;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .big-text {
            font-size: 1.75rem;
            font-weight: bold;
            color: #1374b1;
        }

        .small-text {
            font-size: 1rem;
            color: #666;
        }

        .percentage {
            font-size: 1rem;
            margin-top: 5px;
        }

        .percentage.positive {
            color: #27ae60;
            /* Green */
        }

        .percentage.negative {
            color: #e74c3c;
            /* Red */
        }

        .arrow {
            font-size: 1.2rem;
            vertical-align: middle;
            margin-right: 5px;
        }


        .map-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            max-width: 600px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .pie-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 340px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .rank-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 338px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        /* @media (min-width: 1440px) {
            .rank-container {
                width: 338px;
            }

            .chart-container {
                width: 1200px;

            }
            .pie-container {
                width: 340px;

            }
        } */

        .chart-container {
            background-color: #ffffff;
            width: 1200px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .heatmap-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            /* max-width: 300px; */
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .bar-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 20px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .figure-10-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            max-width: 500px;
            height: 150px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .figure-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 290px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .content-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 240px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .conclusion {
            text-align: center;
            border-radius: 10px;
            background-color: #e3f2fd;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 500px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .content-chart-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 280px;
            overflow: hidden;
            /* Prevent overflow inside containers */
        }

        .chart-title {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .description {
            background-color: #e3f2fd;
            padding-top: 5px;
            padding-bottom: 10px;
            padding-right: 30px;
            padding-left: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 740px;
        }

        .conclude {
            background-color: #e3f2fd;
            padding-top: 5px;
            padding-bottom: 5px;
            padding-right: 30px;
            padding-left: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        p {
            font-size: 1.1em;
            /* Increase font size */
            line-height: 1.6;
            /* Increase line height for better spacing */
            letter-spacing: 1.2px;
            /* Add spacing between letters */
            margin-bottom: 15px;
            /* Add spacing between paragraphs */
        }

        .findings {
            background-color: #ffe0b2;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .figure {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #e67e22;
        }

        .statistic {
            font-weight: bold;
            font-size: 1.5em;
            color: #27ae60;
        }

        h1 {
            padding-bottom: 30px;
        }

        h2 {
            padding-bottom: 15px;
            font-size: 1.5em;

        }

        .text-h2 {
            padding-top: 40px;
            padding-bottom: 15px;
            font-size: 1.5em;

        }

        h3 {
            font-size: 1.25em;
        }
    </style>
</head>

<body>
    <h1>Visualizations of Australian Arrivals and Visa Statistics</h1>
    <h2>#1: Country residents arriving in Australian by Lastest Data (July 2024)</h2>

    <div class="dashboard">
        <div class="figure-container">
            <div class="chart-title">Summary of 2024 Figure</div>
            <div class="figures-grid">
                <div class="figure-item">
                    <span class="big-text">6,414,940 </span><br>
                    <span class="small-text"> total arrivals</span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>
                <div class="figure-item">
                    <span class="big-text">1,249,210</span><br>
                    <span class="small-text">highest arrivals in 1st ranked country (NZ)</span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>
                <div class="figure-item">
                    <span class="big-text">81,244</span><br>
                    <span class="small-text">average arrivals in 1st ranked region (Asia)</span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>

            </div>
        </div>


        <div class="map-container">
            <div class="chart-title">Countries resident arrivals to Australia </div>
            <div id="vis1"></div> <!-- Map Visualization -->
        </div>
        <div class="rank-container">
            <div class="chart-title">Top 5 Citizenships <br>by arrivals</div>
            <div id="vis5"></div> <!-- Map Visualization -->
        </div>
        <!-- <div class="content-container">
            <div class="chart-title">Content for map</div>
            <p>Description/briefly tell story</p>
        </div> -->
        <div class="description">
            <h3>#Findings </h3>
            <p>In the first half of 2024, Australia saw a significant number of international arrivals, with <span
                    style="color:#1374b1;"><strong>6,414,940
                        visitors</strong></span> recorded, represent about <span style="color:#1374b1;"><strong>25% of
                        Australia’s population</strong></span> (26,638,544).
                <br>
                <br>
                The majority of visitors came from <span style="color:#1374b1;"><strong>New Zealand</strong></span> and
                <span style="color:#1374b1;"><strong>East/Southest Asia (Vietnam, Cambodia, Thailand,
                        Malaysia,
                        Japan)</strong></span>, as well as major global partners such
                as the <span style="color:#1374b1;"><strong>United States</strong></span>, <span
                    style="color:#1374b1;"><strong>China</strong></span>.

            </p>
        </div>
        <div class="conclude">
            <h3>#What we leanred</h3>
            <p>
                - Australia’s prominence as a trending travel and migration hub in the
                <span style="color:#1374b1;"><strong> Asia-Pacific</strong></span>
                region.
                - strong tourism and international movement, with Australia continuing to be a <span
                    style="color:#1374b1;"><strong>key destination </strong></span> travelers, businesspeople,
                and migrants.
            </p>

        </div>
        <br>

        <br>

        <div class="text-h2"><strong>
                #2: The past 10 years of Autralian arrivals and visa issued (2014 - 2024) </div>

        </strong>

        <div class="chart-container">
            <div class="chart-title">Arrivals Visa Issued by category in Australia (2014 - 2024)</div>
            <div id="vis2"></div> <!-- Stacked Bar Chart Visualization -->
        </div>
        <!-- <div class="content-chart-container">
            <div class="chart-title">Content for chart</div>
            <p>Description/briefly tell story</p>
        </div> -->
        <div class="description">
            <h3>#Findings</h3>
            <p>Over the last decade from 2014, Visa issuance experienced significant fluctuations due to significant
                effects of global events and policy shifts.
                <br> In 2019, the country reached a peak, issuing around
                <span style="color:#1374b1;"><strong>2 million visas</strong></span> in December within 5 main
                categories.
                <br>
                <br>
                However, the rising of <span style="color:#1374b1;"><strong>COVID-19
                        pandemic</strong></span> in
                early
                2020 marked a turning point. Strict border closures led to a dramatic decline in visa issuances, with
                nearly no arrivals and visas granted during this period.
                <br>This downturn persisted until late 2021, when
                gradual easing
                of restrictions allowed for a resurgence in visa applications and approvals.
                <br> By the start of 2023,
                the country had recovered robustly with similar patterns as the previous period.
            </p>
        </div>
        <div class="conclude">
            <h3>#What we learned</h3>
            <p>
                - Australia's rapid recovery after the pandemic underscores its <span
                    style="color:#1374b1;"><strong>resilience</strong></span> and <span style="color:#1374b1;"><strong>
                        adaption ability </strong></span> to changing circumstances
                <br>
                - implies an appearance of <span style="color:#1374b1;"><strong>effective policy adjustments and a
                        robust partnership and tourism infrastructure </strong></span>
                <br> - reinforcing the position as a preferred destination for travelers and migrants.

            </p>
        </div>

        <div class="figure-container">
            <div class="chart-title">Summary of Past Figure</div>
            <div class="figures-grid">
                <div class="figure-item">
                    <span class="big-text">1,924,920</span><br>
                    <span class="small-text"> highest total visa category (Dec 2019)</span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>
                <div class="figure-item">
                    <span class="big-text">NSW</span><br>
                    <span class="small-text">most visa issued state</span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>
                <div class="figure-item">
                    <span class="big-text">Visitor Visa</span><br>
                    <span class="small-text">most visa issued type </span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>
                <div class="figure-item">
                    <span class="big-text">Higher Edu</span><br>
                    <span class="small-text">most issued student visa purpose </span>
                    <!-- <div class="percentage negative">
                        <span class="arrow">↓</span> 7.3%
                    </div> -->
                </div>

            </div>
        </div>
        <div class="map-container">
            <div class="chart-title">Visa Sub-Types Issued <br> across States</div>
            <br>
            <div id="vis3"></div> <!-- Heatmap Visualization -->
        </div>
        <div class="pie-container">
            <div class="chart-title">Student Visa<br> by study purpose per year</div>
            <br>
            <div id="vis4"></div>
        </div>
        <div class="description">
            <h3>#Findings</h3>
            <p>

                The majority of arrivals were to <span style="color:#1374b1;"><strong>New South Wales</strong></span>
                and the most popular category is temporary visas, notably for visitors and immigrants from <span
                    style="color:#1374b1;"><strong>New Zealand</strong></span>.
                <br>
                <br>
                Following it, <span style="color:#1374b1;"><strong>temporary student visa and permanent skilled visa
                    </strong></span>
                are also a popular choice for people coming to Australia. Especially, studying
                at <span style="color:#1374b1;"><strong> higher education</strong></span> level
                was and is dominance among student visa of all states, which always ocucpied over 65% of total student
                visa.

            </p>
        </div>
        <div class="conclude">
            <h3>#What we learned</h3>
            <p>
                - NSW is the <span style="color:#1374b1;"><strong>most prefarable and welcoming region </strong></span>
                all arrivals among Australia
                <br>- Australia is
                preferable destination for international students pursuing <span style="color:#1374b1;"><strong> higher
                        education </strong></span>

            </p>
        </div>



        <script>
            // Map Visualization
            const citizenMap =
            {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Distribution in first half of 2024",
                "width": 350,
                "height": 300,
                "data": {
                    "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
                    "format": {
                        "type": "topojson",
                        "feature": "ne_110m_admin_0_countries"
                    }
                },
                "projection": {
                    "type": "equalEarth"
                },
                "layer": [
                    {
                        "transform": [
                            {
                                "calculate": "'Data is not available in ' + datum.properties.NAME",
                                "as": "note"
                            }
                        ],
                        "mark": {
                            "type": "geoshape",
                            "fill": "lightgray",
                            "stroke": "white"
                        },
                        "encoding": {
                            "tooltip": {
                                "field": "note"
                            }
                        }
                    },
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                            "format": {
                                "type": "topojson",
                                "feature": "oceans"
                            }
                        },
                        "mark": {
                            "type": "geoshape",
                            "fill": "skyblue"
                        }
                    },
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
                            "format": {
                                "type": "topojson",
                                "feature": "ne_110m_graticules_30"
                            }
                        },
                        "mark": {
                            "type": "geoshape",
                            "fill": null,
                            "stroke": "lightgray"
                        }
                    },
                    {
                        "transform": [
                            {
                                "lookup": "properties.NAME",
                                "from": {
                                    "data": {
                                        "url": "https://raw.githubusercontent.com/pchu0023/ass2/5a0d6da3596ebbd2b09fd3bf5537aa8a9d8211cd/citizenData.csv",
                                        "format": {
                                            "type": "csv"
                                        }
                                    },
                                    "key": "Country",
                                    "fields": [
                                        "Total_Arrival",
                                        "Population"
                                    ]
                                }
                            },
                            {
                                "calculate": "format(datum.Total_Arrival/datum.Population * 100000, '.2f')",
                                "as": "Arrivals per 100,000 population"
                            }
                        ],
                        "mark": {
                            "type": "geoshape"
                        },
                        "encoding": {
                            "color": {
                                "field": "Arrivals per 100,000 population",
                                "type": "quantitative",
                                "title": ["Arrivals per", "100,000", "population"],
                                "scale": {
                                    "type": "threshold",
                                    "domain": [1, 10, 50, 100],
                                    "range": ["#e5f5e0", "#a1d99b", "#74c476", "#41ab5d", "#006d2c"]
                                }
                            },
                            "tooltip": [
                                {
                                    "field": "properties.NAME",
                                    "type": "nominal",
                                    "title": "Country"
                                },
                                {
                                    "field": "Arrivals per 100,000 population",
                                    "type": "quantitative"
                                }
                            ]
                        }
                    },
                    {
                        "data": {
                            "values": [
                                {
                                    "country": "NZ",
                                    "longitude": 167.8850,
                                    "latitude": -35.9006
                                },

                                {
                                    "country": "US",
                                    "longitude": -98.5795,
                                    "latitude": 39.8283
                                },
                                {
                                    "country": "China",
                                    "longitude": 104.1954,
                                    "latitude": 35.8617
                                },
                                {
                                    "country": "East/SE Asia",
                                    "longitude": 150.7669,
                                    "latitude": 23.9078
                                }
                            ]
                        },
                        "mark": {
                            "type": "text",
                            "align": "center",
                            "baseline": "middle",
                            "fontSize": 9,
                            "fontWeight": "bold",
                            "color": "#f61111"
                        },
                        "encoding": {
                            "longitude": {
                                "field": "longitude",
                                "type": "quantitative"
                            },
                            "latitude": {
                                "field": "latitude",
                                "type": "quantitative"
                            },
                            "text": {
                                "field": "country",
                                "type": "nominal"
                            }
                        }
                    }
                ]
            }
                ;

            // Stacked Bar Chart Visualization
            const stackBar =
            {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                // "title": "Arrivals Visa Issued in Australia (2014 - 2024)",
                "width": 940,
                "height": 250,
                "data": {
                    "url": "https://raw.githubusercontent.com/pchu0023/ass2/103fab55969ab2ef1bdb20f8357522798e828558/sub-visa-state.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "params": [
                    {
                        "name": "State_selection",
                        "bind": {
                            "input": "select",
                            "options": [
                                null, "NSW", "VIC", "QLD", "WA", "SA", "TAS", "NT"
                            ],
                            "labels": [
                                "Show All", "New South Wales", "Victoria", "Queensland", "Western Australia", "South Australia", "Tasmania", "Northern Territory"
                            ],
                            "name": "State Selection: "
                        }
                    }
                ],
                "transform": [
                    {
                        "filter": "State_selection == null || datum.State == State_selection"
                    },
                    {
                        "fold": [
                            "Special Category Visa (subclass 444)(f)",
                            "Permanent Visas - Total",
                            "Temporary Student Visas - Total",
                            "Temporary Visitor Visas",
                            "Temporary Other Visas - Total"
                        ],
                        "as": ["Visa Type", "Total"]
                    },
                    {
                        "calculate": "datetime(datum.Month)",
                        "as": "Date"
                    },
                    {
                        "calculate": "replace(datum['Visa Type'], ' - Total', '')",
                        "as": "Visa Type Cleaned"
                    },
                    {
                        "calculate": "replace(datum['Visa Type Cleaned'], 'Special Category Visa (subclass 444)(f)', 'Special Visa 444')",
                        "as": "Visa Type Final"
                    }
                ],
                "layer": [
                    {
                        "mark": "bar",
                        "encoding": {
                            "x": {
                                "field": "Date",
                                "type": "temporal",
                                "axis": {
                                    "title": "Month",
                                    "format": "%b %Y"
                                }
                            },
                            "y": {
                                "aggregate": "sum",
                                "field": "Total",
                                "type": "quantitative",
                                "axis": {
                                    "title": "Total Visa Issued"
                                }
                            },
                            "color": {
                                "field": "Visa Type Final",
                                "type": "nominal",
                                "scale": {
                                    "domain": [
                                        "Permanent Visas",
                                        "Temporary Student Visas",
                                        "Temporary Visitor Visas",
                                        "Temporary Other Visas",
                                        "Special Visa 444"],
                                    "range": [
                                        "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd"
                                    ]
                                },
                                "legend": {
                                    "title": "Visa Category"
                                }
                            },
                            "tooltip": [
                                { "field": "Month", "title": "Month" },
                                { "field": "Total", "title": "Total Visa Issued" },
                                { "field": "Visa Type Final", "title": "Visa Category" },
                                { "field": "State", "title": "State" }
                            ]
                        }
                    },
                    {
                        "mark": {
                            "type": "rect",
                            "fill": "#d3e3ec96",
                            "opacity": 0.5
                        },
                        "encoding": {
                            "x": { "value": 580 },
                            "y": { "value": 80 },
                            "x2": { "value": 730 },
                            "y2": { "value": 170 }
                        }
                    }, {
                        "mark": {
                            "type": "text",
                            "fontSize": 12.5,
                        },
                        "encoding": {
                            "text": { "value": "COVID-19" },
                            "x": { "value": 650 },
                            "y": { "value": 100 }
                        }
                    },
                    {
                        "mark": {
                            "type": "text",
                            "fontSize": 12.5,

                        },
                        "encoding": {
                            "text": { "value": "Border close-open:" },
                            "x": { "value": 650 },
                            "y": { "value": 125 }
                        }
                    },
                    {
                        "mark": {
                            "type": "text",
                            "fontSize": 12.5,

                        },
                        "encoding": {
                            "text": { "value": "Mar 2020 - Nov 2021" },
                            "x": { "value": 650 },
                            "y": { "value": 150 }
                        }
                    }
                ]
            };

            // Heatmap Visualization
            const heatGeneral = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "width": 190,
                "height": 200,
                // "title": "Sub-type visas",
                "data": {
                    "url": "https://raw.githubusercontent.com/pchu0023/ass2/e767a6ad922d24cb0a409a2e1fab26c96bd51bd9/sub-visa-state.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "params": [
                    {
                        "name": "State_selection",
                        "bind": {
                            "input": "select",
                            "options": [
                                null,
                                "NSW",
                                "VIC",
                                "QLD",
                                "WA",
                                "SA",
                                "TAS",
                                "NT"
                            ],
                            "labels": [
                                "Show All",
                                "New South Wales",
                                "Victoria",
                                "Queensland",
                                "Western Australia",
                                "South Australia",
                                "Tasmania",
                                "Northern Territory"
                            ],
                            "name": "State Selection: "
                        }
                    }
                ],
                "transform": [
                    {
                        "filter": "State_selection == null || datum.State == State_selection"
                    },
                    {
                        "fold": [
                            "Permanent Family Visas",
                            "Permanent Skilled Visas",
                            "Permanent Other Visas",
                            "Temporary Student Visas - Total",
                            "Temporary Skilled Visas",
                            "Temporary Work Visas",
                            "Temporary Other Visas",
                            "Other Visas(h)"
                        ],
                        "as": ["Visa Type", "Count"]
                    },
                    {
                        "calculate": "year(datum.Month + '-01')",
                        "as": "Year"
                    },
                    {
                        "aggregate": [
                            {
                                "op": "sum",
                                "field": "Count",
                                "as": "Total Count"
                            }
                        ],
                        "groupby": ["Year", "Visa Type"]
                    }
                ],
                "encoding": {
                    "x": {
                        "field": "Year",
                        "type": "ordinal",
                        "title": "Year"
                    },
                    "y": {
                        "field": "Visa Type",
                        "type": "nominal",
                        "title": "Visa Sub-Type"
                    },
                    "color": {
                        "field": "Total Count",
                        "type": "quantitative",
                        "title": "Visa Count",
                        "scale": {
                            "domain": [
                                3000, 7000, 10000, 100000, 400000
                            ],
                            "range": ["#f7fbff", "#deebf7", "#9ecae1", "#3182bd", "#08519c"]
                        }
                    },
                    "tooltip": [
                        {
                            "field": "Visa Type",
                            "type": "nominal",
                            "title": "Visa Type"
                        },
                        {
                            "field": "Total Count",
                            "type": "quantitative",
                            "title": "Count"
                        }
                    ]
                },
                "mark": "rect"
            };


            const stuPie =
            {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "height": 240,
                "width": 180,
                "data": {
                    "url": "https://raw.githubusercontent.com/pchu0023/ass2/103fab55969ab2ef1bdb20f8357522798e828558/sub-visa-state.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "transform": [
                    {
                        "calculate": "2000 + parseInt(substring(datum.Month, datum.Month.length - 2))",
                        "as": "Year"
                    },
                    {
                        "fold": [
                            "Temporary Student Visas - Higher Education",
                            "Temporary Student Visas - Vocational ",
                            "Temporary Student Visas - Schools",
                            "Temporary Student Visas - Independent ELICOS",
                            "Temporary Student Visas - Postgraduate Research",
                            "Temporary Student Visas - Other Students"
                        ],
                        "as": ["Visa Type", "Number"]
                    },
                    {
                        "filter": "datum.Number !== null"
                    },
                    {
                        "aggregate": [
                            { "op": "sum", "field": "Number", "as": "Total" }
                        ],
                        "groupby": ["Year", "Visa Type"]
                    },
                    {
                        "joinaggregate": [
                            { "op": "sum", "field": "Total", "as": "YearlyTotal" }
                        ],
                        "groupby": ["Year"]
                    },
                    {
                        "calculate": "datum.Total / datum.YearlyTotal * 100",
                        "as": "Proportion"
                    },
                    {
                        "calculate": "replace(datum['Visa Type'], 'Temporary Student Visas - ', '')",
                        "as": "Visa Type Cleaned"
                    },
                    {
                        "filter": "datum.Year == yearSlider"
                    },
                    {
                        "calculate": "format(datum.Proportion, '.2f') + '%'",
                        "as": "ProportionWithPercentage"
                    }
                ],
                "params": [
                    {
                        "name": "yearSlider",
                        "value": 2014,
                        "bind": {
                            "input": "range",
                            "min": 2014,
                            "max": 2024,
                            "step": 1,
                            "name": "Select Year: "
                        }
                    }
                ],
                "layer": [
                    {
                        "mark": "arc",
                        "encoding": {
                            "theta": {
                                "field": "Proportion",
                                "type": "quantitative",
                                "title": "Proportion of Student Visas (%)"
                            },
                            "color": {
                                "field": "Visa Type Cleaned",
                                "type": "nominal",
                                "title": "Student Visa Type"
                            },
                            "tooltip": [
                                {
                                    "field": "Visa Type Cleaned",
                                    "type": "nominal",
                                    "title": "Visa Type"
                                },
                                {
                                    "field": "Total",
                                    "type": "quantitative",
                                    "title": "Total Visas"
                                },
                                {
                                    "field": "Proportion",
                                    "type": "quantitative",
                                    "title": "Proportion (%)",
                                    "format": ".2f"
                                }
                            ]
                        }
                    },
                    {
                        "mark": {
                            "type": "text",
                            "fontSize": 14,
                            "color": "#fff",
                            "align": "left",
                            "baseline": "middle"
                        },
                        "encoding": {
                            "text": {
                                "value": "1st rank"
                            },
                            "theta": {
                                "value": 60
                            },
                            "radius": {
                                "value": -30
                            }
                        },
                        "transform": [
                            {
                                "filter": "datum['Visa Type Cleaned'] == 'Higher Education'"
                            }
                        ]
                    },
                    {
                        "mark": {
                            "type": "text",
                            "fontSize": 14,
                            "color": "#fff",
                            "align": "left"
                        },
                        "encoding": {
                            "text": {
                                "field": "ProportionWithPercentage",
                                "type": "nominal",
                                "title": "Proportion"
                            },
                            "theta": {
                                "field": "Proportion",
                                "type": "quantitative"
                            },
                            "radius": {
                                "value": -5
                            }
                        },
                        "transform": [
                            {
                                "filter": "datum['Visa Type Cleaned'] == 'Higher Education'"
                            }
                        ]
                    }
                ]
            };
            const topCountryBar =
            {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "A horizontal bar chart showing the top 5 countries by total arrivals (excluding Australia) from an external CSV file.",
                "height": 190,
                "data": {
                    "url": "https://raw.githubusercontent.com/pchu0023/ass2/5a0d6da3596ebbd2b09fd3bf5537aa8a9d8211cd/citizenData.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "transform": [
                    {
                        "calculate": "parseInt(datum.Total_Arrival)",
                        "as": "Total_Arrival"
                    },
                    {
                        "calculate": "datum.Country === 'United States of America' ? 'US' : datum.Country",
                        "as": "Country"
                    },
                    {
                        "window": [
                            {
                                "op": "rank",
                                "as": "rank"
                            }
                        ],
                        "sort": [
                            {
                                "field": "Total_Arrival",
                                "order": "descending"
                            }
                        ]
                    },
                    {
                        "filter": "datum.rank <= 5"
                    }
                ],
                "layer": [
                    {
                        "mark": "bar",
                        "encoding": {
                            "y": {
                                "field": "Country",
                                "type": "nominal",
                                "sort": "-x",
                                "axis": {
                                    "title": "Country"
                                }
                            },
                            "x": {
                                "field": "Total_Arrival",
                                "type": "quantitative",
                                "axis": {
                                    "title": "Total Arrivals"
                                }
                            },
                            "tooltip": [
                                {
                                    "field": "Country",
                                    "type": "nominal",
                                    "title": "Country"
                                },
                                {
                                    "field": "Total_Arrival",
                                    "type": "quantitative",
                                    "title": "Total Arrivals"
                                }
                            ]
                        }
                    },
                    {
                        "mark": {
                            "type": "text",
                            "fontSize": 12.5,
                            "color": "#ffffff"
                        },
                        "encoding": {
                            "text": {
                                "value": "1st Rank (19.5% of total)"
                            },
                            "x": {
                                "value": 100
                            },
                            "y": {
                                "value": 20
                            }
                        }
                    }
                ]
            };

            // Render all visualizations
            vegaEmbed('#vis1', citizenMap, { renderer: 'svg', actions: false }).then(console.log).catch(console.warn);
            vegaEmbed('#vis2', stackBar, { renderer: 'svg', actions: false }).then(console.log).catch(console.warn);
            vegaEmbed('#vis3', heatGeneral, { renderer: 'svg', actions: false }).then(console.log).catch(console.warn);
            vegaEmbed('#vis4', stuPie, { renderer: 'svg', actions: false }).then(console.log).catch(console.warn);
            // Placeholder for future visualization in vis5
            vegaEmbed('#vis5', topCountryBar, { renderer: 'svg', actions: false }).then(console.log).catch(console.warn);
        </script>
</body>

</html>
